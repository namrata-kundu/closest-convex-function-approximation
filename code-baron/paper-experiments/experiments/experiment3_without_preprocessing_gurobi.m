
pieces = [-inf(), 1, 2.5, 6, inf()];
f = [
    (1/2), 0, 0, 0;
    0, 2, -1, 1;
    1, -(1/2), 7, -5];

no_of_bkpts_per_pieces = 1:50;
yalmiptime=[];
solvertime=[];
cputime=[];
tictoctime=[];
objs=[];
epsilon=1e-3;


for i=3:34
    no_of_pieces = size(f,2)*i;
    [rho,new_pieces,  objective]  = nearest_convex_function_variable_pieces_of_fixed_num(f,pieces,no_of_pieces);

    
        tStarttic = tic;  

%       [simple_rho,simple_rho_pieces ] = simple_merging_based_on_values(rho,new_pieces, epsilon);
     [g,g_pieces, num_of_pieces, objective] = decrease_pieces_of_convex_function(rho,new_pieces , epsilon, @gurobi_algo3_new_model);

    tEndtoc = toc(tStarttic);

    objs=[objs, value(objective)];
%     yalmiptime=[yalmiptime, sol.yalmiptime];
%     solvertime=[solvertime, sol.solvertime];
    tictoctime=[tictoctime, tEndtoc];

end

%BARON 2024 march version
% tictoctime = [1.83286560000000	2.33666940000000	3.16273410000000	3.32197670000000	4.69956090000000	6.33950690000000	6.64807650000000	7.33258920000000	9.07867260000000	9.51261730000000	10.0616581000000	10.6663326000000	11.8284486000000	12.6978525000000	14.0975463000000	16.6812149000000	16.0666725000000	20.2111259000000	20.1600377000000	21.7330558000000	24.2957927000000	23.3482438000000	28.4861150000000	35.0166034000000	33.3689128000000	36.1532665000000	38.0908776000000	46.3627193000000	47.0253072000000	53.5339606000000	61.4106494000000	63.2644469000000	70.7737852000000	71.1277720000000	75.7948551000000	76.9361717000000	85.4373462000000	97.1900521000000	122.859531100000	133.588665200000	128.831314200000	153.291876100000	153.456760200000	162.252838200000	178.037990000000	189.820349900000	208.411141900000	211.856406100000	224.240231600000];
% yalmiptime = [0.132259799999996	0.147734600000001	0.181693099999999	0.225644800000002	0.233428699999994	0.259489400000000	0.288702000000002	0.331971700000000	0.384641100000001	0.383036500000000	0.437134199999996	0.458312300000003	0.514638000000000	0.563320600000000	0.603519599999997	0.697858999999995	0.704296499999998	0.783180100000001	0.876299300000006	0.846099100000000	0.935273800000000	0.872801900000000	0.925104200000000	1.10426800000000	1.08164650000000	1.08356640000000	1.08594350000000	1.11522490000000	1.21817750000000	1.25399599999999	1.33704860000000	1.37421390000000	1.98305730000000	1.83309330000000	1.88707810000000	1.96726880000000	2.02567810000000	2.21285800000000	2.56640000000000	2.70443730000000	2.79065870000000	2.94119950000000	3.03369600000000	3.25017590000000	3.20331770000000	3.39253170000000	3.61271240000000	3.68760560000000	3.90793950000001];
% solvertime = [1.02474020000000	1.30926540000000	1.91330690000000	1.77635520000000	2.72957130000000	3.80751060000000	3.50929800000000	3.74102830000000	3.91235890000000	5.03896350000000	4.51286580000000	4.92768770000000	5.16536200000000	4.62867940000000	5.65248040000000	7.16714100000000	5.11670350000000	8.02881990000000	6.64570070000000	6.59590090000000	7.89872620000000	6.00819810000000	9.55189580000000	12.1357320000000	9.52435350000000	10.9004336000000	11.2320565000000	10.8827751000000	9.57682250000000	11.9500040000000	16.7289514000000	14.6397861000000	12.2109427000000	11.3239067000000	13.8439219000000	10.4357312000000	12.3793219000000	11.5951420000000	20.7106000000000	24.7095627000000	13.0433413000000	28.7278005000000	20.8283040000000	20.2678241000000	25.6366823000000	27.1364683000000	32.0872876000000	24.7923944000000	30.4470605000000];
% objs = [9.45730290426582	9.45730306707992	9.45730289175845	9.45730285678292	9.45731809877907	9.45730308677594	9.45730293496308	9.45731623287429	9.45730290233041	9.45732770653558	9.45730287341576	9.45730287650076	9.45730293673114	9.45730313254171	9.45730272648507	9.45736341211159	9.45730287563492	9.45730299886782	9.45734656150307	9.45730285355967	9.45730401120090	9.45730291734799	9.45730289337371	9.45730423231726	9.45822918784688	9.45730290256324	9.45730295122485	9.45730286467733	9.45730289677158	9.45730291390646	9.45731054832140	9.45730342008756	9.45809740522964	9.45840968764969	9.45730290055508	9.45730279942654	9.45730290314532	9.45730290323263	9.45733376384305	9.45730291839573	9.45730293488305	9.45730306276528	9.45730322846794	9.45730288721825	9.45734940779948	15.3675487223445	9.45730296582769	9.46014833655499	9.45730301721778];
bla=[[]]
tictoctime = [6.55870620000000	8.21828710000000	9.49103840000000	15.8489941000000	18.2580611000000	28.4252191000000	25.6587971000000	36.0630470000000	39.3439153000000	57.2749970000000	49.8949178000000	54.4287239000000	64.9757437000000	71.9577806000000	71.6517001000000	86.3263923000000	92.2415889000000	95.9249364000000	100.593423700000	112.860660100000	129.793003000000	142.139263400000	158.244890900000	212.047900100000	158.017685500000	226.412634900000	161.735966300000	178.732533000000	183.472595900000	270.802668000000	244.344791300000	3575.53066720000];
objs = [-5.74214347182078e-06	-3.71004076800408e-08	78.0569977401208	0.986372287378195	1450.35519216860	403.953862409526	-2.77975800599961e-07	-193.978647153586	0.997965053251392	2.58114596363157e-09	-0.000151176011969512	-1.45287177094647	999.609699097248	-180.909426231712	-4.41662587036262e-06	86.5195531174078	85.2625026453785	0.00359470479210744	280.374179758154	-3.00428499586732e-09	227.524093672102	2.42951259155626	108.046934104432	-111.869396179539	1103.54799950693	23811.1515909097	-3.43675175991376e-09	7.29923744502425e-08	3.47166084074813e-10	433.972598250004	1247.69129680273	0.0351536721566220];

plot(size(f,2)*no_of_bkpts_per_pieces, yalmiptime)
plot(size(f,2)*no_of_bkpts_per_pieces, solvertime)
plot(size(f,2)*no_of_bkpts_per_pieces, objs)
plot(size(f,2)*no_of_bkpts_per_pieces, tictoctime, 'LineWidth',2)
grid on;
title('Computation time vs. number of breakpoints')

xlabel('Number of breakpoints') 
ylabel('Computation Time') 
